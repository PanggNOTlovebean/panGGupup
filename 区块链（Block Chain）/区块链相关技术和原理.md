# 区块链相关技术和原理

## 哈希算法

哈希运算具有的特性：正向快速、输入敏感、逆向困难、强抗碰撞

> 把牛切成开晒成牛肉干，牛肉干不能再复原成一头牛

哈希算法主要用来保障数据真实性(即完整性)，即发信人将原始消息和哈希值一起发送，收信人通过相同的哈希函数来校验原始数据是否真实。

1. 以上不能保证数据被恶意篡改，原始数据和哈希值都可能被恶意篡改，要保证不被篡改，可以使用RSA公钥私钥方案，再配合哈希值。

2. 哈希算法主要用来防止计算机传输过程中的错误，早期计算机通过前7位数据第8位奇偶校验码来保障（12.5%的浪费效率低），对于一段数据或文件，通过哈希算法生成128bit或者256bit的哈希值，如果校验有问题要求重传

3. **常见的哈希算法有哪些？**

   常见的哈希算法有MD2、MD4、MD5、SHA1、SHA256和SHA512，比特币主要使用的哈希算法就是SHA256（SHA256占256个 Bit ，十六进制表示就是64位）。

### MD5

**MD5** 是输入不定长度信息，输出固定长度 128-bits 的算法。经过程序流程，生成四个32位数据，最后联合起来成为一个 128-bits 散列。

基本方式为，求余、取余、调整长度、与链接变量进行循环运算，得出结果。

**MD5** 计算广泛应用于错误检查。在一些 BitTorrent 下载中，软件通过计算 MD5 来检验下载到的碎片的完整性。

### SHA-256

SHA-256 算法输入报文的最大长度不超过2^64 bit，输入按512-bit 分组进行处理，产生的输出是一个256-bit 的报文摘要。

## 哈希算法构建链式结构

每个区块头部包含了上一个区块数据的哈希值，这些哈希层层嵌套，最终将所有区块串联起来，形成区块链。

要篡改一笔交易，本区块哈希值就会变化，他之后所有区块的父区块哈希全部要篡改一遍，即要保证能够连续伪造多个区块。



## 哈希算法构建默克尔树

一个区块多笔交易，每笔交易计算一个哈希值，两两分组通过两个哈希值计算新的哈希值，直到最后只剩下一个根节点。通过二叉树搜索的方式验证结点即可以准确识别被篡改的交易。

## 数字签名

**在网络中传输数据时候，给数据添加一个数字签名，表示是谁发的数据，而且还能证明数据没有被篡改**

>张三拥有私钥  张三的朋友A拥有公钥
>
>1. A给张三写邮件，A用公钥对邮件加密，张三用私钥解密



>2. 张三给A写邮件：
>
>张三对原数据进行HASH 得到摘要，用私钥加密，得到数字签名 连同原数据一起发送出去
>
>A收到后用公钥对数字签名进行解密，解密成功得到摘要  证明是张三发的
>
>再对元数据进行HASH 对照摘要如果相等证明无人篡改过

## 数字证书

如果有人把真实服务器发给浏览器的公钥更换，用自己的私钥对数据进行hash 数字签名，那么接收方不会察觉到任何问题，因为公私钥都被调包了。

数字证书来解决这一问题，由数字认证机构CA颁发，证书里包含了真实服务器的公钥和其他信息，数字证书机构用自己的私钥加密后发送给浏览器。

CA机构终极安全

## 区块链中的数字签名

每个节点拥有公钥私钥对，发送交易时先用自己的私钥对交易内容进行签名，并将签名附加到交易中，进行广播。

其他节点收到广播信息，对数字签名进行验证，完成消息完整性和身份合法性验证，才会触发后序交易流程

## 共识算法

区块链的一致性问题，以前有中心机构A，每个人只要复制中心机构A的数据就行了，现在去中心化了，甚至动不动还有人来搞破坏，干扰整个区块链系统的一致性怎么保证大家的数据一致性？

### PoW(proof of work)工作量证明类共识算法

每个区块赋予一个难题，解答难题，告知其他结点，收获赏金。

最长链有效 评判机制

>比特币白皮书规定，节点永远认为最长链是正确的区块链，并将持续在它上面延长。
>
>如果给你转账的比特币交易不记录在最长链上，你将有可能面临财产损失。
>
>怎样算是“最长的区块链”呢？因为全世界的矿工同时在挖矿，有可能同时有2个矿工算出了正确的答案，那么区块链就会形成分叉，剩下的矿工有可能在其中任意一条分叉上继续挖矿，延长区块链。
>
>所以我们通常要求在比特币转账被打包之后，还需要经历6个区块的确认，确保矿工不会再回到另一条分叉上挖矿时，才算真正的转账成功。

### Po*凭证类共识算法

引入凭证的概念，根据节点的属性（拥有的币数，持币时间，可贡献的计算资源、声誉）等定义结点出块的难度和优先级，降低了出块开销，一定程度上有悖于‘去中心化‘的思想 ，且多数该类型算法未经过正确性证明，狂攻击力不够明确，节点缺乏参与动力

### BFT  拜占庭容错 类算法

定期选一个领导者，其他结点举手表决是否接受，如果大部分结点都认为领导者存在问题，可以协商推翻

通信开销比较大，不适合节点数较大的系统

### 结合可信执行环境的共识算法

软硬件结合，保证在该类环境中的操作绝对安全可靠，很大程度上可以消除而已节点的不规范或恶意操作。

## 智能合约

> 一个智能合约是一套以数字形式定义的承诺，包括合约参与方可以在上面执行这些承诺的协议

一种满足一定条件，自动执行的计算机程序，例如自动售货机。

